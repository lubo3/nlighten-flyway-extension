<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <!-- jboss-parent only provides versions of maven plugin and their default configurations this makes 
    pom.xml shorter and more consistent. It also allows simple way to override versions of plugins from parent 
    pom -->
  <parent>
    <groupId>org.jboss</groupId>
    <artifactId>jboss-parent</artifactId>
    <version>20</version>
    <relativePath />
  </parent>

  <groupId>me.jboss.flyway</groupId>
  <artifactId>flyway-extension</artifactId>
  <version>1.0-SNAPSHOT</version>

  <name>WildFly: Subsystem Artifact</name>

  <packaging>jar</packaging>

  <properties>
    <version.wildfly.core>2.0.10.Final</version.wildfly.core>
    <version.junit>4.12</version.junit>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <module.name>me.jboss.flyway</module.name>
    <!--set source level to 1.8 -->
    <maven.compiler.target>1.8</maven.compiler.target>
    <maven.compiler.source>1.8</maven.compiler.source>

  </properties>


  <build>
    <!-- Maven will append the version to the finalName (which is the name given to the generated war, 
      and hence the context root) -->
    <finalName>${project.artifactId}</finalName>
    <plugins>
      <!--<plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-surefire-plugin</artifactId> 
        <version>${version.surefire.plugin}</version> <configuration> <redirectTestOutputToFile>true</redirectTestOutputToFile> 
        <enableAssertions>true</enableAssertions> <argLine>-Xmx512m</argLine> <systemProperties> <property> <name>jboss.home</name> 
        <value>${jboss.home}</value> </property> </systemProperties> <includes> <include>**/*TestCase.java</include> 
        </includes> <forkMode>once</forkMode> </configuration> </plugin> -->
      <plugin>
        <artifactId>maven-assembly-plugin</artifactId>
        <version>${version.assembly.plugin}</version>
        <configuration>
          <filters>
            <filter>src/assemble/filter.properties</filter>
          </filters>
          <descriptors>
            <descriptor>src/assemble/distribution.xml</descriptor>
          </descriptors>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-antrun-plugin</artifactId>
        <inherited>false</inherited>
        <version>${version.antrun.plugin}</version>
        <executions>
          <execution>
            <id>build-dist</id>
            <goals>
              <goal>run</goal>
            </goals>
            <phase>package</phase>
            <configuration>
              <target>
                <!-- Replace the '.' in ${module.name} with '/' to get its path -->
                <tempfile property="temp.file" />
                <echo message="${module.name}" file="${temp.file}" />
                <replace file="${temp.file}" token="." value="/" />
                <loadfile srcfile="${temp.file}" property="module.path" />
                <delete file="${temp.file}" />

                <delete dir="target/module" />
                <property name="module.dir" value="target/module/${module.path}/main" />

                <copy file="src/main/resources/module/main/module.xml" tofile="${module.dir}/module.xml" />
                <copy file="target/${project.artifactId}.jar" todir="${module.dir}" />

                <echo>Module ${module.name} has been created in the target/module directory. Copy to
                  your WildFly installation.</echo>
              </target>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <groupId>com.googlecode.flyway</groupId>
        <artifactId>flyway-maven-plugin</artifactId>
        <version>1.7</version>
        <configuration>
          <driver>org.postgresql.Driver</driver>
          <url>jdbc:postgresql://localhost:5432/postgres</url>
          <user>postgres</user>
          <password>password</password>
        </configuration>
      </plugin>
    </plugins>
  </build>

  <dependencyManagement>
    <dependencies>
      <dependency>
        <groupId>org.wildfly.core</groupId>
        <artifactId>wildfly-controller</artifactId>
        <version>${version.wildfly.core}</version>
      </dependency>
      <dependency>
        <groupId>org.wildfly.core</groupId>
        <artifactId>wildfly-server</artifactId>
        <version>${version.wildfly.core}</version>
      </dependency>
      <dependency>
        <groupId>org.wildfly.core</groupId>
        <artifactId>wildfly-subsystem-test</artifactId>
        <type>pom</type>
        <scope>test</scope>
        <version>${version.wildfly.core}</version>
      </dependency>
      <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <scope>test</scope>
        <version>${version.junit}</version>
      </dependency>
    </dependencies>
  </dependencyManagement>

  <dependencies>
    <dependency>
      <groupId>org.wildfly.core</groupId>
      <artifactId>wildfly-controller</artifactId>
    </dependency>
    <dependency>
      <groupId>org.wildfly.core</groupId>
      <artifactId>wildfly-server</artifactId>
    </dependency>
    <dependency>
      <groupId>org.wildfly.core</groupId>
      <artifactId>wildfly-subsystem-test</artifactId>
      <type>pom</type>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.flywaydb</groupId>
      <artifactId>flyway-core</artifactId>
      <version>4.0.3</version>
    </dependency>
    <dependency>
      <groupId>com.h2database</groupId>
      <artifactId>h2</artifactId>
      <version>1.3.170</version>
    </dependency>
    <dependency>
      <groupId>postgresql</groupId>
      <artifactId>postgresql</artifactId>
      <version>9.1-901-1.jdbc4</version>
    </dependency>
  </dependencies>
</project>